<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>考勤计算</title>
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="/lib/bootstrap/css/bootstrap.css">
    <script src="/lib/jquery-3.3.1.min.js" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" href="/lib/bootstrap/css/bootstrap-select.min.css">
    <script type="text/javascript" src="../static/lib/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../static/lib/bootstrap/js/bootstrap-select.min.js"></script>
    <script src="/lib/WdatePicker.js" type="text/javascript"></script>
    <script src="/lib/defaults-zh_CN.js" type="text/javascript"></script>
</head>
<script>

    $(function () {
        var flag = $("#flag").val();
        var flag1 = $("#flag1").val();
        var flag2 = $("#flag2").val();
        var errorMessage = $("#errorMessage").val();
        if (flag == 1) {
            $("#errormessage").show();
            var errormessagediv = document.getElementById("errormessage");
            errormessagediv.innerHTML = "&nbsp;&nbsp;&nbsp;计算成功!";
            errormessagediv.style.color = "green";
        }
        if (flag1 == 1) {
            $("#errormessage1").show();
            var errormessagediv = document.getElementById("errormessage1");
            errormessagediv.innerHTML = "&nbsp;&nbsp;&nbsp;数据导入成功!";
            errormessagediv.style.color = "green";
        }
        if (flag1.includes("重复")) {
            $("#errormessage1").show();
            var errormessagediv = document.getElementById("errormessage1");
            errormessagediv.innerHTML = "&nbsp;&nbsp;&nbsp;"+flag1;
            errormessagediv.style.color = "red";
        }

        if (flag1.includes("失败")) {
            $("#errormessage1").show();
            var errormessagediv = document.getElementById("errormessage1");
            errormessagediv.innerHTML = "&nbsp;&nbsp;&nbsp;"+flag1;
            errormessagediv.style.color = "red";
        }

        if (flag1 == 10) {
            $("#errormessage1").show();
            var errormessagediv = document.getElementById("errormessage1");
            errormessagediv.innerHTML = "&nbsp;&nbsp;&nbsp;数据全导入系统成功,可进入相应模块查看!";
            errormessagediv.style.color = "green";
        }

        if(flag2.length>1) {
            $("#errormessage").show();
            var errormessagediv = document.getElementById("errormessage");
            errormessagediv.innerHTML = "&nbsp;&nbsp;&nbsp;计算成功!文件名为:"+flag2;
            errormessagediv.style.color = "green";
        }

        if(errorMessage.length>1) {
            $("#errormessage").show();
            var errormessagediv = document.getElementById("errormessage");
            errormessagediv.innerHTML = "&nbsp;&nbsp;&nbsp;计算失败!原因为:"+errorMessage;
            errormessagediv.style.color = "red";
        }
    });

    function inDataToMysql() {
        var originFile = $("#originFile1").val();
        if (originFile.trim().length > 0 ) {
            $("#errormessage1").show();
            var errormessagediv1 = document.getElementById("errormessage1");
            errormessagediv1.innerHTML = "&nbsp;&nbsp;&nbsp;导入中,请稍等!";
            errormessagediv1.style.color = "green";
            var form = document.getElementById('inData');
            form.submit();
        } else if (originFile.trim().length <= 0) {
            $("#errormessage1").show();
            var errormessagediv1 = document.getElementById("errormessage1");
            errormessagediv1.innerHTML = "&nbsp;&nbsp;&nbsp;您还没有上传表格，无法计算!";
            errormessagediv1.style.color = "red";
        }
    }

    function computeWorkTable() {
        var originFile = $("#originFile").val();
        var filelocat = $("#filelocat").val();
        if (filelocat.trim().length <= 0) {
            $("#filelocat").val($("#orginLcation").val());
        }
        if (originFile.trim().length > 0 && filelocat.trim().length > 0) {
            $("#errormessage").show();
            var errormessagediv = document.getElementById("errormessage");
            errormessagediv.innerHTML = "&nbsp;&nbsp;&nbsp;计算中,请稍等!";
            errormessagediv.style.color = "green";
            var form = document.getElementById('computeForm');
            form.submit();
        } else if (originFile.trim().length <= 0) {
            $("#errormessage").show();
            var errormessagediv = document.getElementById("errormessage");
            errormessagediv.innerHTML = "&nbsp;&nbsp;&nbsp;您还没有上传表格，无法计算!";
            errormessagediv.style.color = "red";
        }
    }

    String.prototype.trim = function () {
        return this.replace(/(^\s*)|(\s*$)/g, "");
    }
</script>
<style type="text/css">
    a {
        white-space: nowrap;
    }

    table tr td {
        white-space: nowrap;
    }

</style>
<body>

<div id='app'>
    <form  id="computeForm" th:action="@{/person/computeWorkTable}" th:method="post" enctype="multipart/form-data" >
        <input type="hidden" id="flag" th:value="${flag}">
        <input type="hidden" id="flag2" th:value="${flag2}">
        <input type="hidden" id="errorMessage" th:value="${errorMessage}">
        <input type="hidden" id="orginLcation"   th:value="compute.fileLocation">
        <div class="panel panel-primary">
            <div class="panel-heading">
                <h3 class="panel-title">考勤计算</h3>
            </div>
            <div class="panel-body form-inline">
                <table class="table table-bordered table-hover table-striped">
                    <tr>
                        <td><label>文件选择:</label></td>
                        <td>
                            <input type="file"   th:name="file"  id="originFile">
                        </td>
                    </tr>
                    <tr>
                        <td><label>计算结果存放至：</label></td>
                        <td>
                            <input type="text" class="form-control"  th:name="fileLocation" th:value="${compute.fileLocation}" style="width: 500px"
                                   id="filelocat">
                        </td>
                    </tr>
                    <tr>
                        <td><label>动作：</label></td>
                        <td>
                            <button type="button" class="btn btn-primary" onclick="computeWorkTable()">计算</button>
                        </td>
                    </tr>

                    <tr>
                        <td><label>结果提示：</label></td>
                        <td>
                            <div style="display: none;" id="errormessage">

                            </div>
                        </td>
                    </tr>

                </table>
            </div>
        </div>
    </form>


    <form  id="inData" th:action="@{/person/dataInMysql}" th:method="post" enctype="multipart/form-data" >
        <input type="hidden" id="flag1" th:value="${flag1}">
        <div class="panel panel-primary">
            <div class="panel-heading">
                <h3 class="panel-title">数据导入</h3>
            </div>
            <div class="panel-body form-inline">
                <table class="table table-bordered table-hover table-striped">
                    <tr>
                        <td><label>文件选择:</label></td>
                        <td>
                            <input type="file"   th:name="file1"  id="originFile1">
                        </td>
                    </tr>
                    <tr>
                        <td><label>动作：</label></td>
                        <td>
                            <button type="button" class="btn btn-primary" onclick="inDataToMysql()">导入执行</button>
                        </td>
                    </tr>

                    <tr>
                        <td><label>结果提示：</label></td>
                        <td>
                            <div style="display: none;" id="errormessage1">

                            </div>
                        </td>
                    </tr>

                </table>
            </div>
        </div>
    </form>


</div>

</body>
</html>