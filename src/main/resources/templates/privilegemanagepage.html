<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>设计文件</title>
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="/lib/bootstrap/css/bootstrap.css">
    <link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.css">
    <script src="/lib/jquery-1.11.1.min.js" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" href="/stylesheets/theme.css">
    <link rel="stylesheet" type="text/css" href="/stylesheets/premium.css">

</head>
<body class=" theme-blue">

<!-- Demo page code -->

<script type="text/javascript">
    $(function () {
        altRows("privilegetable");
        var match = document.cookie.match(new RegExp('color=([^;]+)'));
        if (match) var color = match[1];
        if (color) {
            $('body').removeClass(function (index, css) {
                return (css.match(/\btheme-\S+/g) || []).join(' ')
            })
            $('body').addClass('theme-' + color);
        }

        $('[data-popover="true"]').popover({html: true});

    });

    function altRows(id){
        if(document.getElementsByTagName){

            var table = document.getElementById(id);
            var rows = table.getElementsByTagName("tr");
            rows[0].className = "evenrowcolor";

        }
    }
</script>
<style type="text/css">

    table.grid {
        font-family: verdana,arial,sans-serif;
        font-size:13px;
        border-width: 1px;
        border-collapse: collapse;
    }
    table.grid th {
        border-width: 1px;
        padding: 8px;
        border-style: solid;
    }
    table.grid td {
        border-width: 1px;
        padding: 8px;
        border-style: solid;
    }

    table.altrowstable {
        font-family: verdana,arial,sans-serif;
        font-size:13px;
        color:#333333;
        border-width: 1px;
        border-color: #D1EEEE;
        border-collapse: collapse;
    }
    table.altrowstable th {
        border-width: 1px;
        padding: 8px;
        border-style: solid;
        border-color: #D1EEEE;
    }
    table.altrowstable td {
        border-width: 1px;
        padding: 8px;
        border-style: solid;
        border-color: #D1EEEE;
    }
    .oddrowcolor{
        background-color:#D1EEEE;
    }
    .evenrowcolor{
        background-color:#c3dde0;
    }

    #line-chart {
        height: 300px;
        width: 800px;
        margin: 0px auto;
        margin-top: 1em;
    }

    .navbar-default .navbar-brand, .navbar-default .navbar-brand:hover {
        color: #fff;
    }
</style>

<script type="text/javascript">
    $(function () {
        var uls = $('.sidebar-nav > ul > *').clone();
        uls.addClass('visible-xs');
        $('#main-menu').append(uls.clone());
    });
</script>

<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
<!--[if lt IE 9]>
<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->

<!-- Le fav and touch icons -->
<link rel="shortcut icon" href="../assets/ico/favicon.ico">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
<link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">


<!--[if lt IE 7 ]>
<body class="ie ie6"> <![endif]-->
<!--[if IE 7 ]>
<body class="ie ie7 "> <![endif]-->
<!--[if IE 8 ]>
<body class="ie ie8 "> <![endif]-->
<!--[if IE 9 ]>
<body class="ie ie9 "> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!-->

<!--<![endif]-->

<div class="navbar navbar-default" role="navigation">
    <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </button>
        <a class="" href="index.html"><span class="navbar-brand"><span class="fa fa-paper-plane"></span> 深圳柯赛标识公司</span></a>
    </div>

    <div class="navbar-collapse collapse" style="height: 1px;">
        <ul id="main-menu" class="nav navbar-nav navbar-right">
            <li class="dropdown hidden-xs">
                <div th:if="${view!=null and view.userName!=null}">

                        <span class="glyphicon glyphicon-user padding-right-small"
                              style="position:relative;top: 3px;"></span>
                    <p th:text="${view.userName}"></p>
                    <!--<i class="fa fa-caret-down"></i>-->

                </div>
                <div th:if="${view==null or view.userName==null}">
                    <a th:href="@{/account/tologin}" class="dropdown-toggle">
                        <span class="glyphicon glyphicon-user padding-right-small"
                              style="position:relative;top: 3px;"></span>请登录
                        <i class="fa fa-caret-down"></i>
                    </a>
                </div>

            </li>
        </ul>

    </div>
</div>
</div>


<div class="sidebar-nav">
    <ul>
        <li><a href="#" data-target=".dashboard-menu" class="nav-header" data-toggle="collapse"><i
                class="fa fa-fw fa-dashboard"></i> 文件<i class="fa fa-collapse"></i></a></li>
        <li>
            <ul class="dashboard-menu nav nav-list collapse in">
                <li>
                    <a th:href="@{/fileupdown/toprivilegemanagepage(userName=${view.userName},password=${view.password})}"><span
                            class="fa fa-caret-right"></span> 设计文件</a></li>
                <li><a href="uploadpage.html"><span class="fa fa-caret-right"></span> 规范性文件</a></li>
                <li><a href="uploadpage.html"><span class="fa fa-caret-right"></span> 学习性文件</a></li>
            </ul>
        </li>

        <li data-popover="true"
            data-content="Items in this group require a <strong><a href='http://portnine.com/bootstrap-themes/aircraft' target='blank'>premium license</a><strong>."
            rel="popover" data-placement="right"><a href="#" data-target=".premium-menu" class="nav-header collapsed"
                                                    data-toggle="collapse"><i class="fa fa-fw fa-fighter-jet"></i> 权限<i
                class="fa fa-collapse"></i></a></li>
        <li>
            <ul class="premium-menu nav nav-list collapse">
                <li class="visible-xs visible-sm"><a href="#">- Premium features require a license -</a></span>
                <li><a href="premium-profile.html"><span class="fa fa-caret-right"></span> Enhanced Profile</a></li>
                <li><a href="premium-blog.html"><span class="fa fa-caret-right"></span> Blog</a></li>
                <li><a href="premium-blog-item.html"><span class="fa fa-caret-right"></span> Blog Page</a></li>
                <li><a href="premium-pricing-tables.html"><span class="fa fa-caret-right"></span> Pricing Tables</a>
                </li>
                <li><a href="premium-upgrade-account.html"><span class="fa fa-caret-right"></span> Upgrade Account</a>
                </li>
                <li><a href="premium-widgets.html"><span class="fa fa-caret-right"></span> Widgets</a></li>
                <li><a href="premium-timeline.html"><span class="fa fa-caret-right"></span> Activity Timeline</a></li>
                <li><a href="premium-users.html"><span class="fa fa-caret-right"></span> Enhanced Users List</a></li>
                <li><a href="premium-media.html"><span class="fa fa-caret-right"></span> Enhanced Media</a></li>
                <li><a href="premium-invoice.html"><span class="fa fa-caret-right"></span> Invoice</a></li>
                <li><a href="premium-build.html"><span class="fa fa-caret-right"></span> Advanced Tools</a></li>
                <li><a href="premium-colors.html"><span class="fa fa-caret-right"></span> Additional Color Themes</a>
                </li>
            </ul>
        </li>

        <li><a href="#" data-target=".accounts-menu" class="nav-header collapsed" data-toggle="collapse"><i
                class="fa fa-fw fa-briefcase"></i>报表 <span class="label label-info">+3</span></a></li>
        <li>
            <ul class="accounts-menu nav nav-list collapse">
                <li><a href="sign-in.html"><span class="fa fa-caret-right"></span> Sign In</a></li>
                <li><a href="sign-up.html"><span class="fa fa-caret-right"></span> Sign Up</a></li>
                <li><a href="reset-password.html"><span class="fa fa-caret-right"></span> Reset Password</a></li>
            </ul>
        </li>
   </ul>
</div>

<div class="content">

    <div id="tabs">
        <ul>
            <a class="btn btn-primary" href="#uploadpage">上传</a>
            <a class="btn btn-default" th:href="@{/fileupdown/download(userName=${view.userName},password=${view.password})}"> 下载</a>
            <a class="btn btn-default" th:href="@{/fileupdown/toprivilmanagepage(userName=${view.userName},password=${view.password})}">管理</a>
        </ul>

        <div id="some-element">
        <form >
            用户 <select name="selectuser" id="selectuser" th:each="userinfo : ${userInfos}">
                <option th:value="${userinfo.uId}" th:text="${userinfo.userName}"></option>
        </select>
            <input type="button" onclick="submitprivilegestatus()" value="确认">
        </form>
        <br/>
        <br/>

        <div id="privimanage">
            <form>
                <table class="grid" style="width: 100%" id="privilegetable">
                    <thead>
                    <tr>
                        <td>编号</td>
                        <td>创建者</td>
                        <td>最后修改者</td>
                        <td>文件名</td>
                        <td>业务员</td>
                        <td>订单编码</td>
                        <td>顶目名称</td>
                        <td>创建时间</td>
                        <td>更新时间</td>
                        <td>权限设置</td>
                    </tr>
                    </thead>
                    <tbody id="showlistbody">
                        <tr th:each="downloadView ,iterStat: ${downloadViewList}"  th:id="${downloadView.id}">
                            <td th:text="${iterStat.index+1}"></td>
                            <td th:text="${downloadView.creator}"></td>
                            <td th:text="${downloadView.lastUpdator}"></td>
                            <td th:text="${downloadView.fileName}"></td>
                            <td th:text="${downloadView.salor}"></td>
                            <td th:text="${downloadView.orderNo}"></td>
                            <td th:text="${downloadView.projectName}"></td>
                            <td th:text="${downloadView.createTime}"></td>
                            <td th:text="${downloadView.lastUpdateTime}"></td>
                            <td ><input th:name="'privilegenum'+${downloadView.id}"  type="checkbox"  th:checked="${downloadView.seePrivilege eq '1' }"  th:value="1">查看
                                <input th:name="'privilegenum'+${downloadView.id}"  type="checkbox" th:checked="${downloadView.updatePrivilege eq '2' }" th:value="2">修改
                                <input th:name="'privilegenum'+${downloadView.id}"  type="checkbox" th:checked="${downloadView.cancelPrivilege eq '3' }" th:value="3">取消</a></td>
                        </tr>
                    </tbody>
                </table>
            </form>

        </div>

    </div>
    </div>

</div>


<script src="/lib/bootstrap/js/bootstrap.js"></script>
<script type="text/javascript">

    function submitprivilegestatus() {
        // 显示loading
        var privilelist=new Array();

        var selectuser = $("#selectuser").val();
        var trs = $("#privilegetable tr");
        privilelist[0]= selectuser;
        for (var i = 1; i < trs.length; i++) {
            var trid = trs[i].id;//privilegenum
            privilelist[i]=trid;
            $('input[name="privilegenum' + trid + '"]:checked').each(function(){//拼接是重点  容易拼接出错
                privilelist[i]+=","+$(this).val();
            });
        }
        $.ajax({
            data:JSON.stringify(privilelist),
            type:"POST",
            dataType: 'json',
            contentType: 'application/json;charset=UTF-8', //内容类型
            contentType :"application/json",  // 这种方式必须要
            async : false,//是否异步请求
            traditional: true,
            url:"/fileupdown/updateandsaveprivilegestatus",
            success:function(msg){
                var data = eval(msg);//将msg化为数;
                var num = 0;
                var tr="";
                var td="";
                var tbody = $("#showlistbody");
                tbody.html("");
                var vililegeflags;
                $.each(data, function (num){

                    tr = $("<tr id='"+data[num].id+"'></tr>");
                    tr.append("<td>" + (num + 1) + "</td>");
                    tr.append("<td>" + isNull(data[num].creator) + "</td>");
                    tr.append("<td>" + isNull(data[num].lastUpdator)  + "</td>");
                    tr.append("<td>" + isNull(data[num].fileName)  + "</td>");
                    tr.append("<td>" + isNull(data[num].salor)  + "</td>");
                    tr.append("<td>" + isNull(data[num].orderNo)  + "</td>");
                    tr.append("<td>" + isNull(data[num].projectName)  + "</td>");
                    tr.append("<td>" + isNull(data[num].createTime)  + "</td>");
                    tr.append("<td>" + isNull(data[num].lastUpdateTime)  + "</td>");
                    td = "<td>";

                    vililegeflags = data[num].opRight;
                    if(isNull(vililegeflags)!=""){
                        td = "<td>";
                        if(vililegeflags.indexOf("1") > -1){
                            td += ('<input name="privilegenum'+data[num].id+'" checked="checked" type="checkbox" value="1" />查看');
                        }else {
                            td += ('<input name="privilegenum'+data[num].id+'"  type="checkbox" value="1" />查看');
                        }
                        if(vililegeflags.indexOf("2") > -1){
                            td += ('<input name="privilegenum'+data[num].id+'" checked="checked" type="checkbox" value="2" />修改');
                        }else{
                            td += ('<input name="privilegenum'+data[num].id+'"  type="checkbox" value="2" />修改');
                        }
                        if(vililegeflags.indexOf("3") > -1){
                            td += ('<input name="privilegenum'+data[num].id+'" checked="checked" type="checkbox" value="3" />取消');
                        }else{
                            td += ('<input name="privilegenum'+data[num].id+'"  type="checkbox" value="3" />取消');
                        }
                        td += "</td>";
                    } else {
                        td = ('<td><input name="privilegenum'+data[num].id+'"  type="checkbox" value="1" />查看');
                        td += ('<input name="privilegenum'+data[num].id+'"  type="checkbox" value="2" />修改');
                        td += ('<input name="privilegenum'+data[num].id+'"  type="checkbox" value="3" />取消</td>');
                    }

                    tr.append(td);
                    tr.appendTo(tbody);
                    // 隐藏loading
                });

            },
            error:function(data){
                // 隐藏loading
                alert("失败");
            }

        });

    }

    function isNull(arg1)
    {
        if(arg1 == "null" || arg1 == null) {
            return "";
        }
        return arg1;
        //return !arg1 && arg1!==0 && typeof arg1!=="boolean"?true:false;
    }

    $("[rel=tooltip]").tooltip();
    $(function () {
        $('.demo-cancel-click').click(function () {
            return false;
        });
    });
</script>


</body>
</html>
